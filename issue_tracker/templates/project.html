{% extends 'base.html' %}

{% block content %}
  {% set project = user_project.project %}
  {% set role_name = user_project.role.name %}
  <h1>{{ project.title }}</h1>
  <p>{{ project.description }}</p>

  <ul class="list-group">
    {% for user_project in user_projects %}
      {% set user = user_project.user %}
      <li class="list-group-item">
        {{ user.first_name }} {{ user.last_name }} --- {{ user_project.role.name }}
        {% if role_name == 'Admin' and user_project.user != current_user %}
          <form action="{{ url_for('main.delete_member', id=project.id) }}" method='post'>
            <input type="hidden" name="user_id" value="{{ user_project.user_id }}">
            <button type="submit">delete</button>
          </form>
        {% endif %}
      </li>
    {% endfor %}
  </ul>

  {% if role_name == 'Admin' %}
    <form id="invitation-form" action="{{ url_for('main.project', id=project.id) }}" method="post" novalidate>
      {{ invitation_form.hidden_tag() }} 
      {{ invitation_form.email.label }}<br>
      {{ invitation_form.email(placeholder='email') }}
      as
      {{ invitation_form.role }}
      {% for error in invitation_form.errors.values() %}
        <span style="color: red;">{{ error }}</span>
      {% endfor %}
    </form>
    <button type="submit" class="btn btn-primary" form="invitation-form">Invite</button>

    <form action="{{ url_for('main.delete_project', id=project.id) }}" method="post">
      <button type="submit">delete</button>
    </form>
  {% else %}
    <form action="{{ url_for('main.delete_member', id=project.id) }}" method="post">
      <button type="submit">quit</button>
    </form>
  {% endif %}

{% endblock %}